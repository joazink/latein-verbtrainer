<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lateinischer Verbtrainer</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; padding:12px; }
    h1 { text-align:center; font-size:1.4em; margin:10px 0 12px; }
    nav { text-align:center; margin-bottom:10px; }
    button, select, input { padding:8px; margin:4px; font-size:1em; }
    section { display:none; background:#fff; padding:12px; border-radius:8px; }
    table { border-collapse:collapse; width:100%; margin:8px 0 14px; }
    th, td { border:1px solid #999; padding:6px; text-align:center; }
    .row { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .card { background:#fff; padding:10px; border-radius:8px; margin:10px 0; }
    .correct { color: #0a7a1f; font-weight:700; }
    .wrong { color: #b00020; font-weight:700; }
    h2 { margin-top:0; }
    h3 { margin:18px 0 6px; }
    h4 { margin:10px 0 6px; }
    .muted { color:#555; font-size:0.95em; }
  </style>
</head>

<body>
  <h1>Lateinischer Verbtrainer</h1>

  <nav class="card">
    <button onclick="show('study')">üìò Lernmodus</button>
    <button onclick="show('write')">‚úçÔ∏è Schreibmodus</button>
    <button onclick="show('analyze')">üîç Analysemodus</button>
    <button onclick="show('worksheet')">üìù Arbeitsblatt</button>
    <div class="muted">Hinweis: Ohne L√§ngenzeichen (keine Makrons).</div>
  </nav>

  <section id="study"></section>
  <section id="write"></section>
  <section id="analyze"></section>
  <section id="worksheet"></section>

<script>
/* =========================
   DATA: Persons, Verbs
========================= */
const PERSONS = [
  { p: 1, n: "sg", l: "1. Sg." },
  { p: 2, n: "sg", l: "2. Sg." },
  { p: 3, n: "sg", l: "3. Sg." },
  { p: 1, n: "pl", l: "1. Pl." },
  { p: 2, n: "pl", l: "2. Pl." },
  { p: 3, n: "pl", l: "3. Pl." }
];
function pIndex(p, n) {
  return PERSONS.findIndex(x => x.p === p && x.n === n);
}

const END = {
  presA: ["o","s","t","mus","tis","nt"],
  presP: ["or","ris","tur","mur","mini","ntur"],
  impfA: ["bam","bas","bat","bamus","batis","bant"],
  impfP: ["bar","baris","batur","bamur","bamini","bantur"],
  perfA: ["i","isti","it","imus","istis","erunt"],
  plqA:  ["eram","eras","erat","eramus","eratis","erant"],
  fut2A: ["ero","eris","erit","erimus","eritis","erunt"],
  // school-Latin (simplified) conjunctive active (regular verbs):
  konjPresA: ["em","es","et","emus","etis","ent"],
  konjImpA:  ["rem","res","ret","remus","retis","rent"]
};

const FUT = {
  1: ["bo","bis","bit","bimus","bitis","bunt"],
  2: ["bo","bis","bit","bimus","bitis","bunt"],
  3: ["am","es","et","emus","etis","ent"],
  "3io": ["iam","ies","iet","iemus","ietis","ient"],
  4: ["iam","ies","iet","iemus","ietis","ient"]
};

const VERBS = {
  amare:  { c: 1,    p: "ama",  pf: "amav" },
  monere: { c: 2,    p: "mone", pf: "monu" },
  legere: { c: 3,    p: "lege", pf: "leg"  },
  capere: { c: "3io",p: "cape", pf: "cep"  },
  audire: { c: 4,    p: "audi", pf: "audiv" },

  esse: {
    irr: true,
    pres: ["sum","es","est","sumus","estis","sunt"],
    impf: ["eram","eras","erat","eramus","eratis","erant"],
    fut:  ["ero","eris","erit","erimus","eritis","erunt"],
    perf: ["fui","fuisti","fuit","fuimus","fuistis","fuerunt"],
    plq:  ["fueram","fueras","fuerat","fueramus","fueratis","fuerant"]
  },

  ire: {
    irr: true,
    pres: ["eo","is","it","imus","itis","eunt"],
    impf: ["ibam","ibas","ibat","ibamus","ibatis","ibant"],
    fut:  ["ibo","ibis","ibit","ibimus","ibitis","ibunt"],
    perf: ["ii","isti","iit","iimus","istis","ierunt"],
    plq:  ["ieram","ieras","ierat","ieramus","ieratis","ierant"]
  },

  ferre: {
    irr: true,
    pres: ["fero","fers","fert","ferimus","fertis","ferunt"],
    impf: ["ferebam","ferebas","ferebat","ferebamus","ferebatis","ferebant"],
    fut:  ["feram","feres","feret","feremus","feretis","ferent"],
    perf: ["tuli","tulisti","tulit","tulimus","tulistis","tulerunt"],
    plq:  ["tuleram","tuleras","tulerat","tuleramus","tuleratis","tulerant"]
  }
};

/* =========================
   DIFFICULTY (per mode)
========================= */
const DIFFICULTY = {
  easy: {
    verbs: ["amare","monere","audire"],
    modi: ["indikativ"],
    tenses: ["praesens","imperfekt"],
    voices: ["aktiv"]
  },
  medium: {
    verbs: ["amare","monere","legere","capere","audire","esse"],
    modi: ["indikativ"],
    tenses: ["praesens","imperfekt","futur1","perfekt","plusquamperfekt"],
    voices: ["aktiv","passiv"]
  },
  hard: {
    verbs: Object.keys(VERBS),
    modi: ["indikativ","konjunktiv"],
    tenses: ["praesens","imperfekt","futur1","perfekt","plusquamperfekt","futur2"],
    voices: ["aktiv","passiv"]
  }
};

const LABELS = {
  modus: { indikativ: "Indikativ", konjunktiv: "Konjunktiv" },
  tempus: {
    praesens: "Praesens",
    imperfekt: "Imperfekt",
    futur1: "Futur I",
    perfekt: "Perfekt",
    plusquamperfekt: "Plusquamperfekt",
    futur2: "Futur II"
  },
  genus: { aktiv: "Aktiv", passiv: "Passiv" }
};

function rand(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

/* =========================
   CONJUGATION
   (school-Latin scope; no macrons)
========================= */
function conj({ v, modus, tempus, genus, p, n }) {
  const i = pIndex(p, n);
  const V = VERBS[v];

  // Irregulars: support indicative; (no passive for irregulars here)
  if (V.irr) {
    if (genus === "passiv") return "‚Äî";
    if (modus === "konjunktiv") return "‚Äî"; // keep it school-simple; can be added later
    if (tempus === "praesens") return V.pres[i];
    if (tempus === "imperfekt") return V.impf[i];
    if (tempus === "futur1") return V.fut[i];
    if (tempus === "perfekt") return V.perf[i];
    if (tempus === "plusquamperfekt") return V.plq[i];
    if (tempus === "futur2") return "‚Äî";
    return "‚Äî";
  }

  // Regular verbs: Konjunktiv (simplified, active only)
  if (modus === "konjunktiv") {
    if (genus === "passiv") return "‚Äî";
    if (tempus === "praesens") return V.p + END.konjPresA[i];
    if (tempus === "imperfekt") return V.p + "re" + END.konjImpA[i];
    // school extension points:
    return "‚Äî";
  }

  // Regular verbs: Indikativ
  if (genus === "aktiv") {
    if (tempus === "praesens") return V.p + END.presA[i];
    if (tempus === "imperfekt") return V.p + END.impfA[i];
    if (tempus === "futur1") return V.p + FUT[V.c][i];
    if (tempus === "perfekt") return V.pf + END.perfA[i];
    if (tempus === "plusquamperfekt") return V.pf + END.plqA[i];
    if (tempus === "futur2") return V.pf + END.fut2A[i];
    return "‚Äî";
  }

  // Regular verbs: Passiv (school common: praesens + imperfekt)
  if (genus === "passiv") {
    if (tempus === "praesens") return V.p + END.presP[i];
    if (tempus === "imperfekt") return V.p + END.impfP[i];
    return "‚Äî";
  }

  return "‚Äî";
}

/* =========================
   ROUTER
========================= */
function show(id){
  document.querySelectorAll("section").forEach(s => s.style.display = "none");
  const el = document.getElementById(id);
  el.style.display = "block";

  if (id === "study") renderStudy();
  if (id === "write") renderWrite();
  if (id === "analyze") renderAnalyze();
  if (id === "worksheet") renderWorksheet();
}

/* =========================
   STUDY MODE: per-tense tables
========================= */
function renderStudy(){
  const tenses = [
    { label: "Praesens Aktiv",        modus:"indikativ", tempus:"praesens",        genus:"aktiv" },
    { label: "Imperfekt Aktiv",       modus:"indikativ", tempus:"imperfekt",       genus:"aktiv" },
    { label: "Futur I Aktiv",         modus:"indikativ", tempus:"futur1",          genus:"aktiv" },
    { label: "Perfekt Aktiv",         modus:"indikativ", tempus:"perfekt",         genus:"aktiv" },
    { label: "Plusquamperfekt Aktiv", modus:"indikativ", tempus:"plusquamperfekt", genus:"aktiv" },
    { label: "Futur II Aktiv",        modus:"indikativ", tempus:"futur2",          genus:"aktiv" },
    { label: "Praesens Passiv",       modus:"indikativ", tempus:"praesens",        genus:"passiv" },
    { label: "Imperfekt Passiv",      modus:"indikativ", tempus:"imperfekt",       genus:"passiv" },
    { label: "Konjunktiv Praesens",   modus:"konjunktiv",tempus:"praesens",        genus:"aktiv" },
    { label: "Konjunktiv Imperfekt",  modus:"konjunktiv",tempus:"imperfekt",       genus:"aktiv" }
  ];

  let html = `<h2>Lernmodus ‚Äì Tabellen nach Tempus</h2>
              <div class="muted">‚Äû‚Äî‚Äú bedeutet: in dieser App (noch) nicht abgedeckt oder schulisch selten als einfache Endungstabelle.</div>`;

  for (const v of Object.keys(VERBS)) {
    html += `<h3>${v}</h3>`;
    for (const t of tenses) {
      html += `<h4>${t.label}</h4>`;
      html += `<table><tr>${PERSONS.map(p=>`<th>${p.l}</th>`).join("")}</tr><tr>`;
      html += PERSONS.map(p=>{
        const f = conj({ v, modus:t.modus, tempus:t.tempus, genus:t.genus, p:p.p, n:p.n });
        return `<td>${f}</td>`;
      }).join("");
      html += `</tr></table>`;
    }
  }

  document.getElementById("study").innerHTML = html;
}

/* =========================
   WRITE MODE: per-mode difficulty
========================= */
let writeAnswer = "";
function renderWrite(){
  const el = document.getElementById("write");
  el.innerHTML = `
    <h2>Schreibmodus</h2>
    <div class="row">
      <label>Schwierigkeit:
        <select id="writeDiff">
          <option value="easy">Leicht</option>
          <option value="medium">Mittel</option>
          <option value="hard">Schwer</option>
        </select>
      </label>
      <button id="writeNew">Neue Aufgabe</button>
    </div>
    <div id="writeTask" class="card"></div>
  `;

  document.getElementById("writeNew").onclick = newWriteTask;
  newWriteTask();
}

function newWriteTask(){
  const level = document.getElementById("writeDiff").value;
  const cfg = DIFFICULTY[level];

  const v = rand(cfg.verbs);
  const modus = rand(cfg.modi);
  const tempus = rand(cfg.tenses);
  const genus = rand(cfg.voices);
  const pers = rand(PERSONS);

  writeAnswer = conj({ v, modus, tempus, genus, p: pers.p, n: pers.n });

  document.getElementById("writeTask").innerHTML = `
    <div><b>Aufgabe:</b> Bilde die Form.</div>
    <div style="margin:6px 0;">
      <b>${v}</b> ‚Äì ${LABELS.modus[modus] || modus} ‚Äì ${LABELS.tempus[tempus] || tempus} ‚Äì ${LABELS.genus[genus] || genus} ‚Äì ${pers.l}
    </div>
    <input id="writeInput" placeholder="Form eingeben">
    <button id="writeCheck">Pr√ºfen</button>
    <div id="writeFeedback" style="margin-top:6px;"></div>
  `;

  document.getElementById("writeCheck").onclick = () => {
    const user = (document.getElementById("writeInput").value || "").trim();
    const ok = user === writeAnswer;
    document.getElementById("writeFeedback").innerHTML =
      ok
        ? `<span class="correct">‚úîÔ∏è Richtig</span>`
        : `<span class="wrong">‚ùå Falsch</span> ‚Äì L√∂sung: <b>${writeAnswer}</b>`;
  };
}

/* =========================
   ANALYZE MODE: per-mode difficulty
   user selects verb/modus/tempus/genus/person
========================= */
let analyzeSolution = null;

function renderAnalyze(){
  const el = document.getElementById("analyze");
  el.innerHTML = `
    <h2>Analysemodus</h2>
    <div class="row">
      <label>Schwierigkeit:
        <select id="anDiff">
          <option value="easy">Leicht</option>
          <option value="medium">Mittel</option>
          <option value="hard">Schwer</option>
        </select>
      </label>
      <button id="anNew">Neue Form</button>
    </div>

    <div id="anTask" class="card"></div>

    <div class="card">
      <div><b>Bestimme:</b></div>
      <div class="row">
        <label>Verb:
          <select id="anVerb"></select>
        </label>
        <label>Modus:
          <select id="anModus">
            <option value="indikativ">Indikativ</option>
            <option value="konjunktiv">Konjunktiv</option>
          </select>
        </label>
        <label>Tempus:
          <select id="anTempus">
            <option value="praesens">Praesens</option>
            <option value="imperfekt">Imperfekt</option>
            <option value="futur1">Futur I</option>
            <option value="perfekt">Perfekt</option>
            <option value="plusquamperfekt">Plusquamperfekt</option>
            <option value="futur2">Futur II</option>
          </select>
        </label>
        <label>Genus:
          <select id="anGenus">
            <option value="aktiv">Aktiv</option>
            <option value="passiv">Passiv</option>
          </select>
        </label>
        <label>Person:
          <select id="anPerson"></select>
        </label>
      </div>
      <button id="anCheck">Pr√ºfen</button>
      <div id="anFeedback" style="margin-top:6px;"></div>
    </div>
  `;

  // fill person dropdown
  document.getElementById("anPerson").innerHTML =
    PERSONS.map(x => `<option value="${x.p}|${x.n}">${x.l}</option>`).join("");

  document.getElementById("anNew").onclick = newAnalyzeTask;
  document.getElementById("anCheck").onclick = checkAnalyze;

  newAnalyzeTask();
}

function fillAnalyzeVerbOptions(allowedVerbs){
  const sel = document.getElementById("anVerb");
  sel.innerHTML = allowedVerbs.map(v => `<option value="${v}">${v}</option>`).join("");
}

function newAnalyzeTask(){
  const level = document.getElementById("anDiff").value;
  const cfg = DIFFICULTY[level];

  fillAnalyzeVerbOptions(cfg.verbs);

  const v = rand(cfg.verbs);
  const modus = rand(cfg.modi);
  const tempus = rand(cfg.tenses);
  const genus = rand(cfg.voices);
  const pers = rand(PERSONS);

  const form = conj({ v, modus, tempus, genus, p: pers.p, n: pers.n });

  analyzeSolution = { v, modus, tempus, genus, p: pers.p, n: pers.n, form };

  document.getElementById("anTask").innerHTML = `
    <div><b>Form:</b> <span style="font-size:1.2em;">${form}</span></div>
    <div class="muted">W√§hle unten die richtige Bestimmung.</div>
  `;

  // preselect something neutral (not the solution)
  document.getElementById("anVerb").value = cfg.verbs[0];
  document.getElementById("anModus").value = "indikativ";
  document.getElementById("anTempus").value = "praesens";
  document.getElementById("anGenus").value = "aktiv";
  document.getElementById("anPerson").value = "1|sg";

  document.getElementById("anFeedback").innerHTML = "";
}

function checkAnalyze(){
  if (!analyzeSolution) return;

  const v = document.getElementById("anVerb").value;
  const modus = document.getElementById("anModus").value;
  const tempus = document.getElementById("anTempus").value;
  const genus = document.getElementById("anGenus").value;
  const [pStr, n] = document.getElementById("anPerson").value.split("|");
  const p = parseInt(pStr, 10);

  const ok =
    v === analyzeSolution.v &&
    modus === analyzeSolution.modus &&
    tempus === analyzeSolution.tempus &&
    genus === analyzeSolution.genus &&
    p === analyzeSolution.p &&
    n === analyzeSolution.n;

  document.getElementById("anFeedback").innerHTML = ok
    ? `<span class="correct">‚úîÔ∏è Richtig</span>`
    : `<span class="wrong">‚ùå Falsch</span><br>
       L√∂sung: <b>${analyzeSolution.v}</b> ‚Äì ${LABELS.modus[analyzeSolution.modus] || analyzeSolution.modus} ‚Äì
       ${LABELS.tempus[analyzeSolution.tempus] || analyzeSolution.tempus} ‚Äì ${LABELS.genus[analyzeSolution.genus] || analyzeSolution.genus} ‚Äì
       ${PERSONS[pIndex(analyzeSolution.p, analyzeSolution.n)]?.l || ""}`;
}

/* =========================
   WORKSHEET MODE
========================= */
function renderWorksheet(){
  const el = document.getElementById("worksheet");
  el.innerHTML = `
    <h2>Arbeitsblatt</h2>

    <div class="row">
      <label>Schwierigkeit:
        <select id="wsDiff">
          <option value="easy">Leicht</option>
          <option value="medium">Mittel</option>
          <option value="hard">Schwer</option>
        </select>
      </label>

      <label>Aufgabentyp:
        <select id="wsType">
          <option value="write">Konjugieren (Form schreiben)</option>
          <option value="analyze">Bestimmen (Parameter nennen)</option>
          <option value="mixed">Gemischt</option>
        </select>
      </label>

      <label>Anzahl:
        <input id="wsCount" type="number" min="5" max="50" value="10" style="width:90px;">
      </label>

      <label>
        <input id="wsSolutions" type="checkbox" checked>
        L√∂sungen anzeigen
      </label>

      <button id="wsGen">Erzeugen</button>
    </div>

    <div id="wsOutput" class="card"></div>
  `;

  document.getElementById("wsGen").onclick = generateWorksheet;
  document.getElementById("wsOutput").innerHTML =
    `<div class="muted">Tipp: Nach dem Erzeugen kannst du √ºber den Browser drucken oder als PDF speichern.</div>`;
}

function generateWorksheet(){
  const level = document.getElementById("wsDiff").value;
  const cfg = DIFFICULTY[level];
  const type = document.getElementById("wsType").value;
  const count = Math.max(5, Math.min(50, parseInt(document.getElementById("wsCount").value || "10", 10)));
  const showSolutions = document.getElementById("wsSolutions").checked;

  const tasks = [];
  const sols = [];

  for (let i = 1; i <= count; i++) {
    const v = rand(cfg.verbs);
    const modus = rand(cfg.modi);
    const tempus = rand(cfg.tenses);
    const genus = rand(cfg.voices);
    const pers = rand(PERSONS);

    const form = conj({ v, modus, tempus, genus, p: pers.p, n: pers.n });

    const pick = (type === "mixed") ? (Math.random() < 0.5 ? "write" : "analyze") : type;

    if (pick === "write") {
      tasks.push(`${i}. <b>${v}</b> ‚Äì ${LABELS.modus[modus] || modus} ‚Äì ${LABELS.tempus[tempus] || tempus} ‚Äì ${LABELS.genus[genus] || genus} ‚Äì ${pers.l}: ________`);
      sols.push(`${i}. ${form}`);
    } else {
      tasks.push(`${i}. Bestimme: <b>${form}</b>`);
      sols.push(`${i}. ${v} ‚Äì ${LABELS.modus[modus] || modus} ‚Äì ${LABELS.tempus[tempus] || tempus} ‚Äì ${LABELS.genus[genus] || genus} ‚Äì ${pers.l}`);
    }
  }

  const output = `
    <h3>Arbeitsblatt ‚Äì Lateinische Verben</h3>
    <ol>${tasks.map(t => `<li>${t}</li>`).join("")}</ol>
    ${showSolutions ? `<hr><h3>L√∂sungen</h3><ol>${sols.map(s => `<li>${s}</li>`).join("")}</ol>` : ""}
    <button onclick="window.print()">üñ®Ô∏è Drucken / PDF</button>
  `;

  document.getElementById("wsOutput").innerHTML = output;
}

/* =========================
   INIT
========================= */
show("study");
</script>
</body>
</html>
